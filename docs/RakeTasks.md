<!--
# @title Rake Tasks
-->

# Rake Tasks

This document describes how Rake has been customized for the application.

## Rake Task Configuration

### "clean" and "clobber"

The Rake "clean" and "clobber" tasks have been customized to remove files generated by various tools. See the CLEAN and CLOBBER variables in "Rakefile".

For safety, the "clobber" task configuration has some files/directories it will only remove if the RAILS_ENV is set to "development". This is intended to prevent accidental deletion on the production server.

The following is the list of directories for each task:

#### clean
* .yardoc/
* test/reports/

#### clobber

The following files/directories are always deleted:

* coverage/

The following files/directories are deleted if RAILS_ENV='development'

* db/development.sqlite3
* db/development.sqlite3-journal
* db/test.sqlite3
* db/test.sqlite3-journal
* doc/
* log/development.log
* log/test.log
* tmp/


## Custom Rake Tasks

### db:add_cas_user

The application uses CAS authentication to only allow known users to log in. The seed data for the database does not contain any users. The "db:add_cas_user" Rake task enables a user to be added from the command-line.

To add a user:

```
> rake 'db:add_cas_user[<CAS DIRECTORY ID>,<FULL NAME>]'
```

where "\<CAS DIRECTORY ID>" is the CAS directory id of the user, and "\<FULL NAME>" is the full name of the user.

For example, to add "John Smith" with a CAS Directory ID of "jsmith":

```
> rake 'db:add_cas_user[jsmith, John Smith]'
```

### db:add_role

The "db:add_role" task is used to add a role to a user.

See [AuthNZ.md](AuthNz.md) for more information, but the four roles are:

* Admin
* Division
* Department
* Unit

Users are allowed to have multiple roles.

Any existing user can be added to a role using the following Rake task:

```
> rake 'db:add_role[<CAS DIRECTORY ID>,<ROLE TYPE>,<ORG CODE>]'
```

replacing the "\<CAS DIRECTORY ID>" with the CAS Directory ID of a known user, providing a "\<ROLE TYPE>" of "admin", "division", "department", or "unit", and an "\<ORG CODE>" corresponding to the role type (optional for "admin" roles).

For example, to create an "Admin" role for the "jsmith" user:

```
> rake 'db:add_role[jsmith, admin]'
```

To give a Department role to "jsmith" for the "SSDR" department:

```
> rake 'db:add_role[jsmith, department, SSDR]'
```